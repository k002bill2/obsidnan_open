# 🔧 Custom Frames 저장 오류 해결 가이드

NotebookLM Custom Frames에서 "**저장 실패: Failed to fetch**" 오류 발생 시 해결 방법입니다.

---

## ⚡ 빠른 해결 (90% 해결)

1. **Obsidian 재시작**: `Cmd + Q` → 다시 열기
2. **Custom Frames에서 다시 시도**

---

## 🔍 원인 분석

| 오류 메시지 | 원인 | 해결 방법 |
|------------|------|----------|
| `Failed to fetch` | Local REST API 미실행 | 플러그인 재활성화 |
| `HTTP 401` | API 키 불일치 | API 키 재확인 |
| `HTTP 404` | 저장 폴더 없음 | `NotebookLM` 폴더 생성 |

---

## 🛠️ 단계별 해결 방법

### 1단계: Local REST API 상태 확인

**터미널에서 다음 명령어 실행:**

```bash
curl http://127.0.0.1:27123/ \
  -H "Authorization: Bearer 171c9f4842fe5b6476229473af33bfe4392514641d6fd98fa55283bb04e36db2"
```

**✅ 정상 응답:**
```json
{"status":"OK","authenticated":true}
```

**❌ 실패 시:**
- `curl: (7) Failed to connect` → **포트가 열려있지 않음 (2단계로)**
- `401 Unauthorized` → **API 키 불일치 (3단계로)**

---

### 2단계: Local REST API 플러그인 재활성화

1. **Obsidian 설정 열기** (`Cmd + ,`)
2. **Community Plugins** 클릭
3. **Local REST API** 찾기
4. **토글 OFF → ON** (다시 활성화)
5. **Obsidian 완전 종료 후 재시작** (`Cmd + Q`)

**플러그인 설정 확인:**
- Enable Insecure Server: **✅ ON**
- Insecure Port: **27123**

---

### 3단계: API 키 확인

**현재 설정된 API 키:**
```
171c9f4842fe5b6476229473af33bfe4392514641d6fd98fa55283bb04e36db2
```

**확인 위치:**
1. Obsidian → 설정 → Community Plugins → Local REST API → **API Key**
2. 스크립트 → `.scripts/notebooklm-customframes.js` → `CONFIG.obsidianApiKey`

> [!IMPORTANT]
> 두 값이 **정확히 일치**해야 합니다!

---

### 4단계: 포트 충돌 확인

**포트 27123 사용 중인 프로세스 확인:**
```bash
lsof -i :27123
```

**정상 출력 (Obsidian이 사용 중):**
```
COMMAND   PID   USER   FD   TYPE  ...  NAME
Obsidian  1234  user   65u  IPv4  ...  localhost:27123
```

**포트가 안 보이면:** Local REST API가 비활성화된 상태

---

### 5단계: NotebookLM 폴더 확인

저장 대상 폴더가 존재해야 합니다:

```
프로젝트 루트/
└── NotebookLM/   ← 이 폴더가 있어야 함
```

**폴더가 없다면:**
```bash
mkdir -p "/Users/younghwankang/Downloads/obsidian_lite/NotebookLM"
```

---

## 🚨 고급 문제 해결

### CORS / Mixed Content 오류

Custom Frames에서 HTTPS 사이트(NotebookLM)가 HTTP API(127.0.0.1)로 요청할 때 브라우저가 차단할 수 있습니다.

**해결 방법:**
1. Obsidian **완전 재시작**
2. 그래도 안 되면 **HTTPS 포트 사용** (27124)

### 스크립트에서 HTTPS 포트로 변경:

`.scripts/notebooklm-customframes.js` 파일 수정:

```javascript
const CONFIG = {
    obsidianApiUrl: 'https://127.0.0.1:27124',  // HTTPS 포트로 변경
    // ... 나머지 설정
};
```

> [!CAUTION]
> HTTPS 사용 시 자체 서명 인증서 경고가 나올 수 있습니다.

---

## ✅ 문제 해결 체크리스트

- [ ] Obsidian이 실행 중인가?
- [ ] Local REST API 플러그인이 활성화되어 있는가?
- [ ] "Enable Insecure Server"가 ON인가?
- [ ] 포트 27123이 열려있는가? (`lsof -i :27123`)
- [ ] API 키가 스크립트와 플러그인에서 일치하는가?
- [ ] `NotebookLM` 폴더가 존재하는가?

---

## 📞 여전히 안 되면?

1. **콘솔 로그 확인**: NotebookLM 페이지에서 `Cmd + Option + I` → Console 탭
2. 에러 메시지 전체 복사
3. 추가 분석 요청

---

## 📖 관련 문서

- [NotebookLM 자동 저장 가이드](NotebookLM%20자동%20저장%20가이드.md)
- [Custom Frames에 Obsidian 저장 버튼 추가 가이드](Custom%20Frames에%20Obsidian%20저장%20버튼%20추가%20가이드.md)

---

**최종 수정**: 2025-12-24
